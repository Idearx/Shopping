ec.pkg("ec.member.add");ec.load("RaterStar");ec.load("ajax",{loadType:"lazy"});ec.load("ec.box",{loadType:"lazy"});ec.member.add.getPrdInfoBySkucode=function(){var skuCode=$("#commodity-skuCode").attr("value");if(skuCode==undefined)return;if(skuCode!="")(new ec.ajax).get({url:domainMain+"/product/querySbomCodesInfo.json",data:{"skuCodes":skuCode.join(",")},dataType:"json",timeout:1E4,successFunction:function(json){for(var i=0;i<json.sbomBaseInfoList.length;i++){var p=json.sbomBaseInfoList[i];if(skuCode==p.sbomCode&&p.disPrdId!=null){$("#remark-a-prdimg").attrS("href","/product/"+p.disPrdId+".html#"+p.sbomId);$("#remark-a-prdimg").children("img").attrS("src",ec.mediaPath+p.photoPath+"142_142_"+p.photoName);$("#remark-a-prdname").attrS("href","/product/"+p.disPrdId+".html#"+p.sbomId);$("#remark-a-prdname").textS(p.sbomName)}}}})};var _remarkPrivate={showError:function(text){$("#error-area").show();$("#error-span").html(text)},hideError:function(){$("#error-area").hide()},getSelectedLen:function(){return $(".ce-post-impress-item.selected").length},getSelectedDiyLen:function(){return $(".tag-li-diy-item.selected").length},check:function(){this.hideError();var val=ec.util.trim($("#tag-input").val());if(val.length==0||val===$("#tag-input").attr("placeholder")){this.showError("\u8f93\u5165\u4e0d\u80fd\u4e3a\u7a7a");return false}if(/\s/.test(val)){this.showError("\u6807\u7b7e\u4e2d\u4e0d\u53ef\u4ee5\u6709\u7a7a\u683c");return false}if(val.len()>=13){this.showError("\u6807\u7b7e\u4e0d\u53ef\u4ee5\u8d85\u8fc76\u4e2a\u6c49\u5b57");return false}return true}};ec.member.add.tagOnclick=function(el){var selectedLen=_remarkPrivate.getSelectedLen();var selectedDiyLen=_remarkPrivate.getSelectedDiyLen();if(selectedLen>=5&&!$(el).hasClass("selected"))_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u9009\u62e95\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u9009\u4ec0\u4e48\u5427~");else if(selectedDiyLen>=4&&!$(el).hasClass("selected")&&$(el).hasClass("tag-li-diy-item"))_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u81ea\u5b9a\u4e494\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u5199\u4ec0\u4e48\u5427~");else{_remarkPrivate.hideError();$(el).toggleClass("selected");var ch=$(el).find("input")[0];if(ch)if(ch.checked)ch.checked=false;else ch.checked=true}};ec.member.add.diyOnclick=function(el){var selectedLen=_remarkPrivate.getSelectedLen();var selectedDiyLen=_remarkPrivate.getSelectedDiyLen();if(selectedLen>=5)_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u9009\u62e95\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u9009\u4ec0\u4e48\u5427~");else if(selectedDiyLen>=4)_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u81ea\u5b9a\u4e494\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u5199\u4ec0\u4e48\u5427~");else $("#diy-area").addClass("current")};ec.member.add.addTag=function(){$("#form-submit-error").html("");var selectedLen=_remarkPrivate.getSelectedLen();var selectedDiyLen=_remarkPrivate.getSelectedDiyLen();if(selectedLen>=5)_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u9009\u62e95\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u9009\u4ec0\u4e48\u5427~");else if(selectedDiyLen>=4)_remarkPrivate.showError("\u6700\u591a\u53ea\u80fd\u81ea\u5b9a\u4e494\u4e2a\u6807\u7b7e\u54e6\uff0c\u597d\u597d\u60f3\u60f3\u5199\u4ec0\u4e48\u5427~");else if(_remarkPrivate.check()){$("\x3cli class\x3d'ce-post-impress-item tag-li-diy-item' onclick\x3d'ec.member.add.tagOnclick(this);'\x3e"+"\x3cdiv class\x3d'impress'\x3e\x3cinput type\x3d'checkbox' checked\x3d'checked' name\x3d'diyTags' style\x3d'visibility: hidden; position: absolute;' value\x3d'"+ec.util.trim($("#tag-input").val())+"' id\x3d'diyTags'\x3e\x3c/input\x3e"+"\x3ca href\x3d'javascript:;'\x3e"+ec.util.trim($("#tag-input").val())+"\x3c/a\x3e\x3cs\x3e\x3c/s\x3e\x3c/div\x3e\x3c/li\x3e").insertBefore($("#diy-area")).addClass("selected");$("#tag-input").val("");if(_remarkPrivate.getSelectedLen()>=5)$("#diy-area").removeClass("current")}};ec.member.add.showView=function(){var doc=document,supportPlaceholder="placeholder"in doc.createElement("input"),placeholder=function(input){$(input).addClass("commodity-input-color-999");var text=input.getAttribute("placeholder"),defaultValue=input.defaultValue;if(defaultValue=="")input.value=text;input.onfocus=function(){$(input).removeClass("commodity-input-color-999");if(input.value===text)this.value=""};input.onblur=function(){if(input.value===""){this.value=text;$(input).addClass("commodity-input-color-999")}else $(input).removeClass("commodity-input-color-999")}};if(!supportPlaceholder){var elss=[document.getElementsByTagName("textarea"),document.getElementsByTagName("input")];for(var n=0;n<2;n++){var els=elss[n];for(var i=0;i<els.length;i++){var input=els[i],text=input.getAttribute("placeholder");if((input.type==="text"||input.type==="textarea")&&text)placeholder(input)}}}$("#ct-star").rater({min:1,max:5,width:30,height:22,image:imagePath+"/echannel/star/star10.png",value:$("#commodity-score").val(),after_click:function(ret){$("#commodity-score").valS(ret.number)}});ec.form.input.wordCount("#commodity-content",{max:1,callback:function(len){$("#commodity-word-count").html(len+"/500");if(len>500){$("#form-submit-error").html("\u9ebb\u70e6\u586b\u51991-500\u4e2a\u5b57\u54df");$("#form-submit-error").removeClass("hide");$("#commodity-content").addClass("error");$("#commodity-content").next("label").remove();$("#commodity-content").after("\x3clabel class\x3d'label-error vat'\x3e\x3c/label\x3e")}else{$("#form-submit-error").addClass("hide");$("#form-submit-error").html("");$("#commodity-content").removeClass("error");$("#commodity-content").next(".label-error").remove()}}});$("#li-prdRemark").addClass("current");$("#pathTitle").html("\u5546\u54c1\u8bc4\u4ef7");ec.form.validator.bind("#commodity-content",{type:["require","length","forbidChar"],validOnChange:true,min:1,max:500,autoFocus:true,msg:{"default":""}});ec.member.add.getPrdInfoBySkucode()};$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(obj,options){var css="label-error",msg=options.msg[options.type]||options.msg["default"];msg=msg.length<=0?"\x26nbsp;":msg;switch(options.type){case "require":css="label-error";break}if(options.msg_ct)$(options.msg_ct).addClass("label-error").html(ec.autoEncodeAttr(msg));else{var id=(obj.attr("id")||obj.attr("name"))+"-msg";$("#"+id).remove();obj.after("\x3clabel id\x3d'"+id+"' class\x3d'label-error "+css+"'\x3e"+ec.autoEncodeAttr(msg)+"\x3c/label\x3e");$("#commodity-content-msg").addClass("vat")}if(options.autoFocus)obj.focus()},successFunction:function(obj,options){if(options.msg_ct)$(options.msg_ct).html("").removeClass("label-error");else $("#"+(obj.attr("id")||obj.attr("name"))+"-msg").remove()}});