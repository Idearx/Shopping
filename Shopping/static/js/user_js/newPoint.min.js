ec.pkg("ec.member.newpoint");ec.load("ajax",{loadType:"lazy"});ec.load("jquery.movebar");ec.load("ec.pager");ec.member.newpoint.pageNumber=1;ec.member.newpoint.load=function(page){if(!ec.account.isLogin()){ec.account.afterLogin(function(){window.location.reload()});return}$.ajax({url:openApiDomain+"/point/unifypoint/queryPointHisDetail?pageNum="+page.pageNumber+"&pageSize="+page.pageSize+"&locale=zh_CN",type:"GET",dataType:"json",timeout:1e4,beforeSend:function(xhr){xhr.withCredentials=true},success:function(json){if(json.resultCode!="200000"){return}json=json.data;if(json.rows&&json.rows.length>0){var htmlFtl=[];for(var i=0;i<json.rows.length;i++){var temp="";var p=json.rows[i];htmlFtl.push('<div class="list-group-item">');htmlFtl.push('<table border="0" cellpadding="0" cellspacing="0">');htmlFtl.push("<tbody>");htmlFtl.push("<tr>");var createTime="";if(p.createTime!=null){createTime=p.createTime.substring(0,10)}htmlFtl.push('<td class="col-date">'+createTime+"</td>");var actionDesc="";if(p.actionType!=null){if(p.actionType=="1"||p.actionType=="2"||p.actionType=="3"||p.actionType=="4"||p.actionType=="5"||p.actionType=="6"||p.actionType=="7"||p.actionType=="8"||p.actionType=="REMARK"||p.actionType=="MP"||p.actionType=="CSVC1"||p.actionType=="CSVC4"||p.actionType=="CSVC1CS1"||p.actionType=="CSVC1CS2"||p.actionType=="CSVC1CS3"||p.actionType=="CSVC1CS4"||p.actionType=="CSVC1CS5"||p.actionType=="CSVC1CS6"||p.actionType=="CSVC4CS1"||p.actionType=="CSVC4CS2"||p.actionType=="CSVC4CS3"||p.actionType=="CSVC4CS4"||p.actionType=="CSVC4CS5"||p.actionType=="CSVC4CS6"){temp='<div class="myVip-exp-question"><em></em><b><span class="num">订单编号：'+p.orderCode+"</span></b></div>"}}if(p.sign=="+"){htmlFtl.push('<td class="col-exp"><span>'+p.sign+"&nbsp;"+p.pointValue+"</span></td>")}else if(p.sign=="-"){htmlFtl.push('<td class="col-exp"><em>'+p.sign+"&nbsp;"+p.pointValue+"</em></td>")}else{htmlFtl.push('<td class="col-exp">&nbsp;</td>')}actionDesc=p.actionDesc;var actionDescTail="";var flag=0;if(flag==1){actionDesc+=actionDescTail}htmlFtl.push('<td class="col-soure">'+actionDesc+temp+"</td>");htmlFtl.push('<td class="col-way">');htmlFtl.push("</tr>");htmlFtl.push("</tbody>");htmlFtl.push("</table>");htmlFtl.push("</div>")}$("#list-group-empty").hide();$("#list-group").html(htmlFtl.join(""));$("#list-group").show();page.totalPage=json.pageCount;ec.member.newpoint.renderPage(page);ec.ui.scrollTo("#list-group");$(".myVip-exp-question").each(function(){var myVipTimer;var dom=this;var _obj=$(this);var rightClickEv=function(){clearTimeout(myVipTimer);_obj.unbind("mouseleave");_obj.addClass("hover")};_obj.mouseenter(function(){dom.removeEventListener("contextmenu",rightClickEv);_obj.unbind("mouseleave");clearTimeout(myVipTimer);_obj.addClass("hover");if(navigator.userAgent.toLocaleLowerCase().indexOf("firefox")>-1){dom.addEventListener("contextmenu",rightClickEv)}_obj.mouseleave(function(){myVipTimer=setTimeout(function(){_obj.removeClass("hover")},200)})})})}else{$("#list-group").html("<div class='list-group-empty'>您暂时没有相关记录。</div>")}}})};ec.member.newpoint.renderPage=function(page){$("#list-pager").pager({pageNumber:page.pageNumber,pageCount:page.totalPage,pageSize:10,text:{first:"|&lt;",pre:"&lt",next:"&gt;",last:"&gt;|"},item:["first","pre","qpage","next","last","quickPager"],callBack:ec.member.newpoint.load})};ec.member.newpoint.tabClick=function(dom,index){var $li=$(dom).closest("li");if($li.hasClass("current")){return}else{$li.addClass("current");$li.siblings().removeClass("current");ec.member.newpoint._showTabElement($li,index)}};ec.member.newpoint._showTabElement=function(dom,index){var count=dom.siblings().andSelf().size();for(var i=1;i<=count;i++){if(i==index){$("#tab-common-index-"+i).show()}else{$("#tab-common-index-"+i).hide()}}if(index==3){var page={pageNumber:1,pageSize:10};ec.member.newpoint.load(page)}};ec.member.newpoint._showRule=function(){var $li=$("#ec-tab-grade ul").find("li:eq(2)");$li.mouseenter();$li.find("a").click()};ec.member.newpoint.showUserPointDetail=function(){$.ajax({url:openApiDomain+"/point/queryUserPointBalanceDetail.json",dataType:"json",data:{ifHisDetail:"0"},timeout:1e4,beforeSend:function(xhr){xhr.withCredentials=true},success:function(json){if(json.resultCode!="200000"){return}json=json.data;var freezePoint="";$("#usablePoint").html(json.pointBlance);$("#usableCash").html(json.pointAmount);$("#expirePoint").html(json.lastExpirePointValue);if(json.lastExpireTime!=null){$("#expireTime").html("("+json.lastExpireTime+")")}if(json.status!=null&&json.status=="S"){$("#usablePoint").parent().parent().find("dt").append("（已冻结）");$("#usableCash").parent().parent().find("dt").append("（已冻结）")}}})};ec.ready(function(){$("#li-newpoint").addClass("current");$("#pathTitle").html("我的积分");$("#concern-list :checkbox").click(function(){if(!this.checked){$("#checkAll-top,#checkAll-buttom").prop("checked",false)}});$("#ec-tab-grade").navMove({boxClass:"ec-tab-arrow"});var $li=$("#ec-tab-grade").find(".current");var index=$li.index()+1;ec.member.newpoint._showTabElement($li,index);ec.member.newpoint.showUserPointDetail()});