ec.load("ajax");
ec.pkg("ec.member.zhima");
ec.member.zhima = {
    query: function () {
        $.ajax({
            url: domainUc + "/zm/queryZM.json", dataType: "jsonp", timeout: 1E4, timeoutFunction: function () {
                alert(timeOutInfo)
            }, success: function (d) {
                "200" == d.resultCode && d.userZMInfoVO && 1 == d.userZMInfoVO.certifyStatus && $("#myZhimaPoint").html(d.userZMInfoVO.creditScore)
            }
        })
    }, jump2Index: function () {
        ec.redirectTo("/member/zm")
    }, queryFromIndex: function () {
        var d = $("#creditScore").val(), g = $("#updateTime").val(), k = $("#authFail").val();
        k && "0" == k ? ($("#creditLead").hide(), $("#canvasContent").hide(), $("#myCredit-rz-failed").show(), setTimeout("ec.member.zhima.jump2Index()", 3E3)) : d && g ? (ec.member.zhima.pointsShow(d, g), $("#creditLead").hide()) : $.ajax({
            url: domainUc + "/zm/queryZM.json",
            dataType: "jsonp",
            timeout: 1E4,
            timeoutFunction: function () {
                alert(timeOutInfo)
            },
            success: function (d) {
                "200" == d.resultCode && d.userZMInfoVO && (1 == d.userZMInfoVO.certifyStatus ? (ec.member.zhima.pointsShow(d.userZMInfoVO.creditScore, d.userZMInfoVO.updateTime), $("#creditLead").hide()) : $("#canvasContent").hide())
            }
        })
    }, auth: function () {
        if (ec.form.validator($("#zhima-lead-form"), !0)) {
            var d = $("#zhimaTelephone").val();
            ec.redirectTo(domainUc + "/zm/certifyZM?mobileNo\x3d" + d + "\x26callbackURL\x3d" + (domainMain + "/member/zm/show") + "\x26sourceType\x3dpc")
        }
    }, validateTelephone: function (d) {
        var g = ec.form.validator.bind;
        g(d.find("#zhimaTelephone"), {
            type: ["require", "regex"],
            validOnChange: !0,
            regex: /^(1[34578])[0-9]{9}$/,
            msg_ct: d.find("#zhimaTelephoneError"),
            msg: {
                require: "\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801",
                regex: "\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"
            }
        })
    }, pointsShow: function (d, g) {
        var k = document.getElementById("canvasContent"), n = document.getElementById("drawingBg"),
            q = document.getElementById("drawing"), r = document.getElementById("drawingRun"),
            t = document.getElementById("drawingRunWay"),
            p = [350, "\u8f83\u5dee", 550, "\u4e2d\u7b49", 600, "\u826f\u597d", 650, "\u4f18\u79c0", 700, "\u6781\u597d", 950],
            k = {
                width: 940,
                height: 777,
                fixed: {parent: k, className: "myCredit-canvas-points"},
                fixedColor: {0: "#ef5c49", 1: "#ff9400", 2: "#5dc336 ", 3: "#02bbb7", 4: "#18a2f5"},
                colorGradient: {
                    0: {form: "rgb(244,101,60)", to: "rgb(234,86,84)"},
                    1: {form: "rgb(249, 168, 4)", to: "rgb(249, 115, 5)"},
                    2: {form: "rgb(148, 212, 5)", to: "rgb(42, 178, 44)"},
                    3: {form: "rgb(2, 210, 170)", to: "rgb(3, 164, 195)"},
                    4: {form: "rgb(34, 194, 245)", to: "rgb(14, 131, 245)"}
                },
                points: d,
                total: p,
                circle: {bgObj: n, obj: q, runObj: r, runWayObj: t, x: 470, y: 390, r1: 134, r2: 120, r3: 115, r4: 125}
            }, n = function (a) {
                var b = {
                    0: {form: "rgb(244,101,60)", to: "rgb(234,86,84)"},
                    1: {form: "rgb(249, 168, 4)", to: "rgb(249, 115, 5)"},
                    2: {form: "rgb(148, 212, 5)", to: "rgb(42, 178, 44)"},
                    3: {form: "rgb(2, 210, 170)", to: "rgb(3, 164, 195)"},
                    4: {form: "rgb(34, 194, 245)", to: "rgb(14, 131, 245)"}
                }, c = {0: "#ef5c49", 1: "#ff9400", 2: "#5dc336 ", 3: "#02bbb7", 4: "#18a2f5"};
                this.fixed = a.fixed;
                this.fixedColor = a.fixedColor || c;
                this.points = a.points;
                this.colorGradient = a.colorGradient || b;
                this.circle = a.circle;
                this.width = a.width;
                this.height = a.height
            };
        n.prototype = {
            _drawWh: function () {
                this.circle.bgObj.style.width = this.width + "px";
                this.circle.obj.style.width = this.width + "px";
                this.circle.runObj.style.width = this.width + "px";
                this.circle.runWayObj.style.width = this.width + "px";
                this.circle.bgObj.style.height = this.height + "px";
                this.circle.obj.style.height = this.height + "px";
                this.circle.runObj.style.height = this.height + "px";
                this.circle.runWayObj.style.height = this.height + "px"
            }, _drawBg: function (a) {
                var b = this.circle.bgObj.getContextS("2d"), c = b.createLinearGradient(0, 0, 0, this.width);
                c.addColorStop(0, this.colorGradient[a].form);
                c.addColorStop(1, this.colorGradient[a].to);
                b.fillStyle = c;
                b.fillRect(0, 0, this.width, this.height)
            }, _draw: function () {
                var a = this.circle.obj.getContextS("2d");
                a.beginPath();
                a.arc(this.circle.x, this.circle.y, this.circle.r1, .875 * Math.PI, 2.125 * Math.PI);
                a.lineWidth = 3;
                a.strokeStyle = "rgba(255,255,255,0.3)";
                a.stroke();
                a.closePath();
                a.beginPath();
                a.arc(this.circle.x, this.circle.y, this.circle.r2, .875 * Math.PI, 2.125 * Math.PI);
                a.lineWidth = 10;
                a.strokeStyle = "rgba(255,255,255,0.3)";
                a.stroke();
                a.closePath();
                a.translate(this.circle.x, this.circle.y);
                for (var b = 0; 16 > b; b++) 3 === b % 6 ? this._drawSpan(a, 2, b) : this._drawSpan(a, 1, b);
                a.font = "12px Microsoft YaHei,Arial,sans-serif";
                a.fillStyle = "rgba(255,255,255,0.5)";
                a.textAlign = "center";
                a.textBaseline = "bottom";
                a.rotate(-.625 * Math.PI);
                for (b = 0; 11 > b; b++) a.fillText(p[b], 0, -94), a.rotate(.125 * Math.PI);
                a.rotate(-.75 * Math.PI);
                var b = g.substring(0, 4), c = g.substring(4, 6), f = g.substring(6, 8);
                a.fillText("\u66f4\u65b0\u65f6\u95f4\uff1a" + b + "." + c + "." + f, 0, 80);
                a.font = "14px Microsoft YaHei,Arial,sans-serif";
                a.fillStyle = "rgba(255,255,255,0.3)";
                a.fillText("BETA", 0, -40)
            }, _judge: function (a) {
                var b = 0, c = 0, f = "", e = 0, d = 0, h = 0;
                550 > a && 350 <= a ? (b = a - 350, c = .005 * (a - 350), f = "\u8f83\u5dee", d = e = 0, h = 200) : 600 > a && 550 <= a ? (b = a - 550, c = .02 * (a - 550), f = "\u4e2d\u7b49", e = 1, d = 45, h = 50) : 650 > a && 600 <= a ? (b = a - 600, c = .02 * (a - 600), f = "\u826f\u597d", e = 2, d = 90, h = 50) : 700 > a && 650 <= a ? (b = a - 650, c = .02 * (a - 650), f = "\u4f18\u79c0", e = 3, d = 135, h = 50) : 950 >= a && 700 <= a && (b = a - 700, c = .004 * (a - 700), f = "\u6781\u597d", e = 4, d = 180, h = 250);
                return {value: b, rValue: c, eValue: f, gValue: e, dValue: d, span: h, angle: b / h * 45 + d}
            }, _run: function () {
                function a() {
                    e.translate(-b.circle.x, -b.circle.y);
                    e.clearRect(0, 0, b.width, b.height);
                    e.translate(b.circle.x, b.circle.y);
                    f++;
                    e.beginPath();
                    e.shadowBlur = 10;
                    e.shadowColor = "#fff";
                    e.arc(-b.circle.r1 * Math.sin((f + 67.5) / 180 * Math.PI), b.circle.r1 * Math.cos((f + 67.5) / 180 * Math.PI), 4, 0, 2 * Math.PI, !0);
                    e.fillStyle = "#fff";
                    e.fill();
                    e.strokeStyle = "rgb(255,255,255)";
                    e.stroke();
                    e.closePath();
                    var c;
                    45 > f ? (c = f / 45 * 200 + 350, b._drawBg(0)) : 90 > f ? (c = (f - 45) / 45 * 50 + 550, b._drawBg(1)) : 135 > f ? (c = (f - 90) / 45 * 50 + 600, b._drawBg(2)) : 180 > f ? (c = (f - 135) / 45 * 50 + 650, b._drawBg(3)) : 225 >= f && (c = (f - 180) / 45 * 250 + 700, b._drawBg(4));
                    c = c > h ? h : c;
                    e.shadowBlur = 0;
                    e.font = "60px Arial";
                    e.textAlign = "center";
                    e.textBaseline = "bottom";
                    e.fillText(parseInt(c), 0, 20);
                    e.font = "24px Microsoft YaHei";
                    e.fillText("\u4fe1\u7528" + b._judge(h).eValue, 0, 50);
                    var l = f, m = 0;
                    45 > k ? m = l / 90 : 90 > k ? m = l / 135 : 135 > k ? m = l / 180 : 180 > k ? m = l / 225 : 225 >= k && (m = l / 270);
                    g.translate(-b.circle.x, -b.circle.y);
                    g.translate(b.circle.x, b.circle.y);
                    g.beginPath();
                    g.arc(-b.circle.r1 * Math.sin((l + 67.5) / 180 * Math.PI), b.circle.r1 * Math.cos((l + 67.5) / 180 * Math.PI), 1, 0, 2 * Math.PI, !0);
                    g.fillStyle = "rgba(255,255,255," + m + ")";
                    g.strokeStyle = "rgba(255,255,255," + m + ")";
                    g.fill();
                    g.stroke();
                    g.closePath();
                    f >= k ? clearTimeout(d) : d = setTimeout(a, c / h * 15)
                }

                var b = this, d, f = 0, e = b.circle.runObj.getContextS("2d"), g = b.circle.runWayObj.getContextS("2d");
                e.translate(b.circle.x, b.circle.y);
                g.translate(b.circle.x, b.circle.y);
                var h = b.points || 350, h = 950 < h ? 950 : h, h = 350 > h ? 350 : h;
                b._judge();
                b._drawBg(0);
                var k = b._judge(h).angle;
                a()
            }, _drawSpan: function (a, b, c) {
                a.beginPath();
                a.lineWidth = b;
                a.strokeStyle = "rgba(255,255,255,0.5)";
                a.moveTo(this.circle.r3 * Math.sin(7.5 * c / 180 * Math.PI), -this.circle.r3 * Math.cos(7.5 * c / 180 * Math.PI));
                a.lineTo(this.circle.r4 * Math.sin(7.5 * c / 180 * Math.PI), -this.circle.r4 * Math.cos(7.5 * c / 180 * Math.PI));
                a.moveTo(-this.circle.r3 * Math.sin(7.5 * c / 180 * Math.PI), -this.circle.r3 * Math.cos(7.5 * c / 180 * Math.PI));
                a.lineTo(-this.circle.r4 * Math.sin(7.5 * c / 180 * Math.PI), -this.circle.r4 * Math.cos(7.5 * c / 180 * Math.PI));
                a.stroke();
                a.closePath()
            }, _fixed: function () {
                var a = $(".section-header").height(), b = $(".mc-menu-area").height();
                $(".myCredit-rz").height();
                $("#canvasContent").css({height: b - a - 20 + "px"});
                this.fixed.parent.style.backgroundColor = this.fixedColor[this._judge(d).gValue];
                var a = document.createElement("div"), b = g.substring(0, 4), c = g.substring(4, 6),
                    f = g.substring(6, 8), b = b + "." + c + "." + f;
                a.innerHTML = '\x3cp class\x3d"title"\x3e' + d + '\x3c/p\x3e\x3cp class\x3d"credit"\x3e\u4fe1\u7528' + this._judge(d).eValue + '\x3c/p\x3e\x3cp class\x3d"time"\x3e\u66f4\u65b0\u65f6\u95f4\uff1a' + b + "\x3c/p\x3e";
                a.className = this.fixed.className;
                this.fixed.parent.appendChild(a)
            }, show: function () {
                this._drawWh();
                var a = $(".section-header").height(), b = $(".mc-menu-area").height();
                $(".myCredit-rz").height();
                $("#drawingBg").css({height: b - a - 20 + "px"});
                this.circle.obj.getContext ? (this._draw(), this._run()) : this._fixed()
            }
        };
        (new n(k)).show()
    }
};
ec.ready(function () {
    ec.member.zhima.validateTelephone($("#zhima-lead-form"))
});