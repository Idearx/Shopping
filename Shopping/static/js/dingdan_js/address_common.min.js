ec.pkg("ec.address");ec.load("ajax");ec.load("ec.dh");var _defaultAddress="选择省-市-区-街道";var _defaultTimeOut=1e4;var address=[];var tree_url=domainShoppingConfig+"/data/region/tree/{id}.json";var children_url=domainShoppingConfig+"/data/region/children/{id}.json";var _tempAddress={};var _tempAddressIds={};var addressConfig=null;var cache={},ajaxer;var timeoutId;ec.address.processType="0";ec.address.parseUrl=function(url,id){return url.replace(/{id}/g,id)};ec.address.processAddress=function(){var addressText=$("#current-address").text();var parentId="0";if(addressText==_defaultAddress){_tempAddressIds={};_tempAddress={}}var formId=ec.address.getFormProcessType(ec.address.processType);$("#provice").removeClass("current");$("#city").removeClass("current");$("#district").removeClass("current");$("#street").removeClass("current");$("#provice").show();$("#city").show();$("#district").show();$("#street").hide();_tempAddressIds[0]=$("#provice").attr("data-value");_tempAddressIds[1]=$("#city").attr("data-value");_tempAddressIds[2]=$("#district").attr("data-value");_tempAddressIds[3]=$("#street").attr("data-value");_tempAddress[0]=$("#provice").html();_tempAddress[1]=$("#city").html();_tempAddress[2]=$("#district").html();_tempAddress[3]=$("#street").html();var provice=_tempAddress[0],city=_tempAddress[1],district=_tempAddress[2],street=_tempAddress[3];var proviceId=_tempAddressIds[0],cityId=_tempAddressIds[1],districtId=_tempAddressIds[2],streetId=_tempAddressIds[3];if(!proviceId){addrType=1}else if(!cityId){addrType=1}else if(!districtId){addrType=2}else if(!streetId){addrType=3}else{addrType=4}switch(addrType){case 4:$("#street").textS(ec.address.replaceChar(street));$("#street").show();case 3:$("#district").textS(ec.address.replaceChar(district));case 2:$("#city").textS(city);case 0:case 1:$("#provice").textS(provice)}switch(addrType){case 4:parentId=$("#district").attr("data-value");$("#street").addClass("current");break;case 3:parentId=$("#city").attr("data-value");$("#district").addClass("current");break;case 2:parentId=$("#provice").attr("data-value");$("#city").addClass("current");break;case 1:$("#provice").addClass("current");parentId="0";break}$("#provice_info").find("a").bind("click",ec.address.againSelectAddress);if(addrType<=1){ec.address.queryData(ec.address.parseUrl(tree_url,"0"),true,1,ec.address.queryProvince)}else{ec.address.queryData(ec.address.parseUrl(children_url,parentId),true,addrType,ec.address.queryProvince)}};ec.address.againSelectAddress=function(){var id=$(this).attr("data-value");var parentId=parseInt(id);var addrType=parseInt($(this).attr("level-value"));if((id==null||id=="")&&addrType!=1){return}if($.trim($(this).text()).transHtmlAttribute()=="请选择"){return}var formId=ec.address.getFormProcessType(ec.address.processType);$("#provice").show();$("#city").show();$("#district").show();$("#street").hide();$(".form-address-name-tab").find("a:not(#street)").removeClass();switch(addrType){case 1:$("#provice").addClass("current");$("#city").text("请选择");$("#district").text("请选择");$("#street").text("请选择");_tempAddressIds[1]="";_tempAddressIds[2]="";_tempAddressIds[3]="";_tempAddress[1]="";_tempAddress[2]="";_tempAddress[3]="";parentId="0";$(formId).find("input[name=city]").attr("value","");$(formId).find("input[name=district]").attr("value","");$(formId).find("input[name=street]").attr("value","");$("#city").attr("data-value","");$("#district").attr("data-value","");$("#street").attr("data-value","");break;case 2:$("#city").addClass("current");$("#district").text("请选择");$("#street").text("请选择");_tempAddressIds[2]="";_tempAddressIds[3]="";_tempAddress[2]="";_tempAddress[3]="";parentId=$("#provice").attr("data-value");$(formId).find("input[name=district]").attr("value","");$(formId).find("input[name=street]").attr("value","");$("#district").attr("data-value","");$("#street").attr("data-value","");break;case 3:$("#district").addClass("current");$("#street").text("请选择");$("#street").show();_tempAddressIds[3]="";_tempAddress[3]="";parentId=$("#city").attr("data-value");$(formId).find("input[name=street]").attr("value","");$("#street").attr("data-value","");break;case 4:$("#street").addClass("current");parentId=$("#district").attr("data-value");break}if(addrType==1){ec.address.queryData(ec.address.parseUrl(tree_url,"0"),true,1,ec.address.queryProvince)}else{ec.address.queryData(ec.address.parseUrl(children_url,parentId),true,addrType,ec.address.queryProvince)}};ec.address.changeAddress=function(){var id=$(this).attr("id");var name=ec.address.replaceChar($(this).text());var addrType=parseInt($(this).attr("addrType"));$(".form-address-name-tab").find("a:not(#street)").removeClass();var formId=ec.address.getFormProcessType(ec.address.processType);$("#provice").show();$("#city").show();$("#district").show();$("#street").hide();switch(addrType){case 1:$("#provice").textS(name);$("#provice").attr("data-value",id);$("#city").addClass("current");$("#city").attr("data-value","");$("#district").attr("data-value","");$("#street").attr("data-value","");$("#city").text("请选择");$("#district").text("请选择");$("#street").text("请选择");$(formId).find("input[name=province]").attr("value",id);_tempAddress[0]=$(this).text();_tempAddressIds[0]=id;break;case 2:$("#city").textS(name);$("#city").attr("data-value",id);$("#district").addClass("current");$("#district").attr("data-value","");$("#street").attr("data-value","");$("#district").text("请选择");$("#street").text("请选择");$(formId).find("input[name=city]").attr("value",id);_tempAddress[1]=$(this).text();_tempAddressIds[1]=id;break;case 3:$("#district").textS(name);$("#district").attr("data-value",id);$("#street").addClass("current");$("#street").attr("data-value","");$("#street").text("请选择");$("#street").show();$(formId).find("input[name=district]").attr("value",id);_tempAddress[2]=$(this).text();_tempAddressIds[2]=id;break;case 4:$("#street").textS(name);$("#street").attr("data-value",id);$("#street").addClass("current");$("#street").show();$(formId).find("input[name=street]").attr("value",id);$("#address-tab").hide();_tempAddress[3]=$(this).text();_tempAddressIds[3]=id;break}if(addrType<4){ec.address.queryData(ec.address.parseUrl(children_url,id),true,addrType+1,ec.address.queryProvince)}else{if(_tempAddress!=null&&_tempAddressIds!=null){ec.address.showAddress(_tempAddress)}}};ec.address.queryProvince=function(addressListInfo,addrType){var lst;if(addrType==1){lst=addressListInfo.data[0]}else{lst=addressListInfo.data}var htmlFtl=[];var lstLength=lst.length;if(lstLength>0){if(addrType>=4){$("#street").show()}else{$("#street").removeClass("current");$("#street").text("请选择")}htmlFtl.push('<ul class="clearfix">');var position=0;for(var i=0;i<lstLength;i++){var nodeName=ec.address.replaceChar(lst[i].name);htmlFtl.push('<li id="'+lst[i].id+'" addrType="'+addrType+'"><a href="javascript:;">'+nodeName+"</a></li>")}htmlFtl.push("</ul>");$("#address_table").css({"min-height":"180px"}).html(htmlFtl.join(""));$("#address_table").find("li").bind("click",ec.address.changeAddress);$("#address-tab").show()}else{if(addrType==4){$("#street").hide();$("#district").addClass("current");var formId=ec.address.getFormProcessType(ec.address.processType);$(formId).find("input[name=needL4Addr]").attr("value",false);ec.address.showAddress(_tempAddress)}}};ec.address.queryData=function(url,usecache,addrType,callback){var json;if(usecache&&(json=cache[url])){return callback(json,addrType)}if(ajaxer){ajaxer.abort()}ajaxer=$.ajax({url:url,type:"get",dataType:"json",beforeSend:function(xhr){xhr.withCredentials=true},success:function(json){if(usecache)cache[url]=json;callback(json,addrType)},error:function(xhr,status){logger.warn("load data fail.")}})};ec.address.getCitydistrict=function(addressListInfo){_tempAddress={};var addrsIdArray=addressListInfo.values;var selectId="";var formId=ec.address.getFormProcessType(ec.address.processType);var proviceAddrs=addressListInfo.data[0];for(var i=0;i<proviceAddrs.length;i++){var json=proviceAddrs[i];if(json.id==addrsIdArray[0]){_tempAddress[0]=json.name;$(formId).find("input[name=province]").attr("value",json.id);$(formId).find("input[name=provinceG]").attr("value",json.id);$("#provice").textS(json.name);selectId="provice";break}}var cityAddrs=addressListInfo.data[1];for(var i=0;i<cityAddrs.length;i++){var json=cityAddrs[i];if(json.id==addrsIdArray[1]){_tempAddress[1]=json.name;$(formId).find("input[name=city]").attr("value",json.id);$(formId).find("input[name=cityG]").attr("value",json.id);selectId="city";$("#city").textS(json.name);break}}var districtAddrs=addressListInfo.data[2];for(var i=0;i<districtAddrs.length;i++){var json=districtAddrs[i];if(json.id==addrsIdArray[2]){_tempAddress[2]=json.name;$(formId).find("input[name=district]").attr("value",json.id);$(formId).find("input[name=districtG]").attr("value",json.id);selectId="district";$("#district").textS(json.name);break}}var streetAddrs=addressListInfo.data[3];if($.trim(streetAddrs)!=""&&streetAddrs!=undefined){for(var i=0;i<streetAddrs.length;i++){var json=streetAddrs[i];if(json.id==addrsIdArray[3]){_tempAddress[3]=json.name;$(formId).find("input[name=street]").attr("value",json.id);$(formId).find("input[name=streetG]").attr("value",json.id);selectId="street";$("#street").textS(json.name);break}}}$("#"+selectId).addClass("current").siblings().removeClass("current");ec.address.showAddress(_tempAddress)};ec.address.getAddressIdCallBack=function(json){var addressId=json.districtId;if($.trim(addressId)==""){ec.address.hiddenTips();return}ec.address.showAddress(_tempAddress)};ec.address.showAddress=function(address){$("#current-address").addClass("form-address-detailcon");var adr=ec.address.replaceChar(address[0])+"-"+ec.address.replaceChar(address[1])+"-"+ec.address.replaceChar(address[2]);var street=ec.address.replaceChar(address[3]);if($.trim(street)!=""&&$.trim(street).transHtmlAttribute()!="请选择"&&street!=undefined){adr+="-"+street}$("#current-address").textS(adr);ec.address.hiddenTips();$("#myAddress-msg").hide();$("#myAddress-msg").removeClass();$("#select-address-msg").html("");var formId=ec.address.getFormProcessType(ec.address.processType);if(ec.address.validateAddressOncal==1){ec.member.exchange.getExpress($(formId).find("input[name=province]").attr("value"),$(formId).find("input[name=city]").attr("value"),$(formId).find("input[name=district]").attr("value"),$(formId).find("input[name=street]").attr("value"),function(json){if(!json.success||json.success&&json.carriers.indexOf(2)<0){ec.member.exchange.globalNullTips("该地址暂时无法支持上门取货，请选择自寄方式进行退换货处理。",function(){ec.member.exchange.autoSelect();ec.address.reset();$("#current-address").html("选择省-市-区-街道").removeClass("form-address-detailcon");$("input[name='address']").val("")});return false}},function(){ec.member.exchange.globalNullTips("操作超时，请重试！",function(){ec.address.reset();$("#current-address").html("选择省-市-区-街道").removeClass("form-address-detailcon");$("input[name='address']").val("")});return false})}$(formId).find("input[name=provinceG]").attr("value",$(formId).find("input[name=province]").attr("value"));$(formId).find("input[name=cityG]").attr("value",$(formId).find("input[name=city]").attr("value"));$(formId).find("input[name=districtG]").attr("value",$(formId).find("input[name=district]").attr("value"));$(formId).find("input[name=streetG]").attr("value",$(formId).find("input[name=street]").attr("value"));$(formId).find("input[name=needL4AddrG]").attr("value",$(formId).find("input[name=needL4Addr]").attr("value"))};ec.address.hiddenTips=function(){$("#address-search").hide();$("#address-tab").hide()};ec.address.setDefaultAddress=function(){$("#current-address").html(_defaultAddress)};ec.address.change=function(type){switch(type){case 1:$("#address-tab").hide();$("#address-search").show();break;case 2:$("#address-tab").show();if($("#gouldAddress").val()==1){ec.address.processAddress()}$("#address-search").hide();break}};ec.address.oSearchSuggest=function(searchFuc){var input=$("#address-search input");var suggestWrap=$(".form-address-search-list");var dataText="";var init=function(){input.bind("keyup",ec.address.sendKeyWord)};ec.address.sendKeyWord=function(event){if(suggestWrap.css("display")=="block"&&event.keyCode==38||event.keyCode==40){var current=suggestWrap.find("li p.hover");if(event.keyCode==38){if(current.length>0){var prevLi=current.removeClass("hover").prev();if(prevLi.length>0){prevLi.addClass("hover");input.valS(prevLi.html())}}else{var last=suggestWrap.find("li p:last");last.addClass("hover");input.valS(last.html())}}else if(event.keyCode==40){if(current.length>0){var nextLi=current.removeClass("hover").next();if(nextLi.length>0){nextLi.addClass("hover");input.valS(nextLi.html())}}else{var first=suggestWrap.find("li p:first");first.addClass("hover");input.valS(first.html())}}}else{var valText=$.trim(input.val());if(valText==""||valText==dataText){$("#form-address-no").hide();return}clearTimeout(timeoutId);timeoutId=setTimeout(function(){searchFuc(valText)},300);dataText=valText}};this.dataDisplay=function(data){if(data.length<=0){suggestWrap.hide();return}suggestWrap.find("li p").hover(function(){$(this).parent().find("span").show();suggestWrap.find("li").removeClass("hover");$(this).find("li").addClass("hover");input.valS(this.innerHTML)},function(){$(this).removeClass("hover");$(this).parent().find("span").hide()}).bind("click",function(){input.valS(this.innerHTML);suggestWrap.hide()})};init()};ec.address.location=function(detailAddress,coordinate){var address=coordinate;var obj={location:coordinate};$.ajax({type:"POST",url:domainShoppingConfig+"/data/getRegionInfoByLocation.json",async:false,data:obj,dataType:"json",beforeSend:function(xhr){xhr.withCredentials=true},success:function(data){if($.trim(data)!=""&&data!=undefined){processAddress(detailAddress,data);$("#address-search").hide()}else{$("#form-address-no").show()}}});function processAddress(detail,curData){$("#form-address-no").hide();if(curData.success){var formId=ec.address.getFormProcessType(ec.address.processType);if($.trim(curData.provinceId)!=""&&curData.provinceId!=undefined&&($.trim(curData.cityId)!=""&&curData.cityId!=undefined)&&($.trim(curData.districtId)!=""&&curData.districtId!=undefined)&&(curData.needL4Addr!=""&&curData.needL4Addr)){var street=ec.address.replaceChar(curData.streetName);if($.trim(street)!=""&&street!=undefined){if(ec.address.validateAddressOncal==1){ec.member.exchange.getExpress(curData.provinceId,curData.cityId,curData.districtId,curData.streetId,function(json){if(!json.success||json.success&&json.carriers.indexOf(2)<0){ec.member.exchange.globalNullTips("该地址暂时无法支持上门取货，请选择自寄方式进行退换货处理。",function(){ec.member.exchange.autoSelect();ec.address.reset();$("#current-address").html("选择省-市-区-街道").removeClass("form-address-detailcon");$("input[name='address']").val("")});return false}},function(){ec.member.exchange.globalNullTips("操作超时，请重试！",function(){ec.address.reset();$("#current-address").html("选择省-市-区-街道").removeClass("form-address-detailcon");$("input[name='address']").val("")});return false})}$("#current-address").empty();$("#current-address").addClass("form-address-detailcon");$(formId).find("input[name=province]").attr("value",curData.provinceId);$(formId).find("input[name=city]").attr("value",curData.cityId);$(formId).find("input[name=district]").attr("value",curData.districtId);$("#provice").attr("data-value",curData.provinceId);$("#city").attr("data-value",curData.cityId);$("#district").attr("data-value",curData.districtId);$("#provice").textS(curData.provinceName);$("#city").textS(curData.cityName);$("#district").textS(ec.address.replaceChar(curData.districtName));var adr=curData.provinceName+"-"+curData.cityName+"-"+ec.address.replaceChar(curData.districtName)+"-"+street;$(formId).find("input[name=street]").attr("value",curData.streetId);$("#street").attr("data-value",curData.streetId);$("#street").textS(street);$(formId).find("input[name=needL4Addr]").attr("value",curData.needL4Addr);$(formId).find("input[name=provinceG]").attr("value",$(formId).find("input[name=province]").attr("value"));$(formId).find("input[name=cityG]").attr("value",$(formId).find("input[name=city]").attr("value"));$(formId).find("input[name=districtG]").attr("value",$(formId).find("input[name=district]").attr("value"));$(formId).find("input[name=streetG]").attr("value",$(formId).find("input[name=street]").attr("value"));$(formId).find("input[name=needL4AddrG]").attr("value",$(formId).find("input[name=needL4Addr]").attr("value"));$("#current-address").textS(adr);$('textarea[name="address"]').parent().find("label").hide();if(detail==undefined){detail=""}var html=$("<div>").html(detail);$('textarea[name="address"]').valS(html[0].innerText);$('input[name="address"]').valS(html[0].innerText);if(html[0].innerText!=null&&html[0].innerText!=""&&html[0].innerText!=undefined){$("#address-msg").html("");$("#address-msg").removeClass("report-errors");$("#address-msg").removeClass("label-error");$("#address-msg").removeClass("icon-error");$("#contactAddress-msg").html("");$("#contactAddress-msg").removeClass("label-error");$("#select-address-msg").html("")}$('textarea[name="contactAddress"]').parent().find("label").hide();$('textarea[name="contactAddress"]').valS(html[0].innerText);$("#vatInvoice-address").parent().find("label").hide();$("#vatInvoice-address").valS(html[0].innerText);$("#vatInvoice-address-error").html(" ")}else{ec.address.goSelectAddress(curData);$('textarea[name="address"]').val("");$('textarea[name="address"]').parent().find("label").show();$('textarea[name="contactAddress"]').val("");$('textarea[name="contactAddress"]').parent().find("label").show();$("#vatInvoice-address").val("");$("#vatInvoice-address").parent().find("label").show();$('input[name="address"]').val("")}}else{ec.address.goSelectAddress(curData);$('textarea[name="address"]').val("");$('textarea[name="address"]').parent().find("label").show();$('textarea[name="contactAddress"]').val("");$('textarea[name="contactAddress"]').parent().find("label").show();$("#vatInvoice-address").val("");$("#vatInvoice-address").parent().find("label").show();$('input[name="address"]').val("")}}else{$('textarea[name="address"]').val("");$('textarea[name="address"]').parent().find("label").show();$('textarea[name="contactAddress"]').val("");$('textarea[name="contactAddress"]').parent().find("label").show();$("#vatInvoice-address").val("");$("#vatInvoice-address").parent().find("label").show();$('input[name="address"]').val("");_tempAddress={};$(".form-address-name-tab").find("a:not(#street)").removeClass();ec.address.defaultTabValue();ec.address.cleanValue();ec.address.change(2)}}$("#myAddress-msg").hide();$("#myAddress-msg").removeClass()};ec.address.goSelectAddress=function(curData){_tempAddress={};$(".form-address-name-tab").find("a:not(#street)").removeClass();ec.address.defaultTabValue();ec.address.cleanValue();var formId=ec.address.getFormProcessType(ec.address.processType);$("#provice").removeClass("current");$("#city").removeClass("current");$("#district").removeClass("current");$("#street").removeClass("current");$("#provice").show();$("#city").show();$("#district").show();$("#street").hide();var addrType=1;var aId="0";if($.trim(curData.districtId)!=""&&curData.districtId!=undefined){addrType=3;aId=curData.districtId;$(formId).find("input[name=province]").attr("value",curData.provinceId);$(formId).find("input[name=city]").attr("value",curData.cityId);$(formId).find("input[name=district]").attr("value",curData.districtId);$(formId).find("input[name=street]").attr("value","");_tempAddress[0]=curData.provinceName;_tempAddress[1]=curData.cityName;_tempAddress[2]=curData.districtName;$("#provice").textS(curData.provinceName);$("#city").textS(curData.cityName);$("#district").textS(curData.districtName);$("#city").attr("data-value",curData.cityId);$("#district").attr("data-value",curData.districtId);$("#street").show();$("#street").addClass("current");_tempAddressIds[0]=curData.provinceId;_tempAddressIds[1]=curData.cityId;_tempAddressIds[2]=curData.districtId;$("#provice").attr("data-value",curData.provinceId);$("#city").attr("data-value",curData.cityId);$("#district").attr("data-value",curData.districtId)}else if($.trim(curData.cityId)!=""&&curData.cityId!=undefined){addrType=2;aId=curData.cityId;$(formId).find("input[name=province]").attr("value",curData.provinceId);$(formId).find("input[name=city]").attr("value",curData.cityId);$(formId).find("input[name=district]").attr("value","");$(formId).find("input[name=street]").attr("value","");_tempAddress[0]=curData.provinceName;_tempAddress[1]=curData.cityName;$("#provice").textS(curData.provinceName);$("#city").textS(curData.cityName);$("#city").attr("data-value",curData.cityId);$("#district").addClass("current");_tempAddressIds[0]=curData.provinceId;_tempAddressIds[1]=curData.cityId;$("#provice").attr("data-value",curData.provinceId);$("#city").attr("data-value",curData.cityId)}else if($.trim(curData.provinceId)!=""&&curData.provinceId!=undefined){addrType=1;aId=curData.provinceId;$(formId).find("input[name=province]").attr("value",curData.provinceId);$(formId).find("input[name=city]").attr("value","");$(formId).find("input[name=district]").attr("value","");$(formId).find("input[name=street]").attr("value","");_tempAddress[0]=curData.provinceName;$("#provice").textS(curData.provinceName);$("#city").addClass("current");_tempAddressIds[0]=curData.provinceId;$("#provice").attr("data-value",curData.provinceId)}else{addrType=0}$("#provice_info").find("a").bind("click",ec.address.againSelectAddress);ec.address.setValue(curData);ec.address.queryData(ec.address.parseUrl(children_url,parseInt(aId)),true,addrType+1,ec.address.queryProvince)};ec.address.sendKeyWordToBack=function(keyword){var len=keyword.length;if(len<2){$("#form-address-no").show();$("#address-search .form-address-search-list ul").hide()}else{$("#form-address-no").hide();$("#address-search .form-address-search-list ul").show();var obj={keywords:keyword};$.ajax({type:"POST",url:domainShoppingConfig+"/data/searchByKeywords.json",async:false,data:obj,dataType:"json",beforeSend:function(xhr){xhr.withCredentials=true},success:function(data){var result=data.data;if($.trim(result)!=""&&result!=undefined){addBox(data.data)}else{$("#address-search .form-address-search-list ul").empty();$("#form-address-no").show()}}})}function addBox(data){$("#form-address-no").hide();$("#address-search .form-address-search-list ul").empty();$.each(data,function(index,obj){$("#address-search .form-address-search-list ul").append("<li><p>"+obj["name"]+"</p><span id=pcd-"+index+">"+"</span>"+'<a href="javascript:;" onclick=\'ec.address.location(ec.autoEncodeAttr("'+obj["name"]+'"),"'+obj["location"]+"\")'>选择</a></li>");$("#pcd-"+index).textS(obj["provinceName"]+obj["cityName"]+obj["distinctName"])})}};ec.address.cleanKeyWord=function(){$("#address-search input").val("")};ec.address.bindSeelctEvent=function(){new ec.address.oSearchSuggest(ec.address.sendKeyWordToBack);$("#current-address").bind("click",function(){if($("#gouldAddress").val()==0){ec.address.processAddress()}else{$("#address-search").show()}});$(".btn-address-close").bind("click",function(){ec.address.hiddenTips()});$(".form-address-search-text a").click(function(){ec.address.cleanKeyWord()})};ec.address.setValue=function(addressInfo){if(addressInfo.province!=undefined&&addressInfo.province!=""){_tempAddress[0]=addressInfo.provinceName;_tempAddressIds[0]=addressInfo.province;$("#provice").attr("data-value",addressInfo.province);$("#provice").textS(addressInfo.provinceName)}if(addressInfo.city!=undefined&&addressInfo.city!=""){_tempAddress[1]=addressInfo.cityName;_tempAddressIds[1]=addressInfo.city;$("#city").attr("data-value",addressInfo.city);$("#city").textS(addressInfo.cityName)}if(addressInfo.district!=undefined&&addressInfo.district!=""){_tempAddress[2]=addressInfo.districtName;_tempAddressIds[2]=addressInfo.district;$("#district").attr("data-value",addressInfo.district);$("#district").textS(addressInfo.districtName)}if(addressInfo.street!=undefined&&addressInfo.street!=""){_tempAddress[3]=addressInfo.streetName;_tempAddressIds[3]=addressInfo.street;$("#street").attr("data-value",addressInfo.street);$("#street").textS(addressInfo.streetName)}};ec.address.defaultTabValue=function(){$("#provice").text("请选择");$("#city").text("请选择");$("#district").text("请选择");$("#street").text("请选择");$("#street").hide();$("#provice").attr("data-value","");$("#city").attr("data-value","");$("#district").attr("data-value","");$("#street").attr("data-value","");$(".form-address-name-tab").find("a").removeClass()};ec.address.cleanValue=function(){address=[];_tempAddress={};_tempAddressIds={}};ec.address.cleanFormValue=function(){var formId=ec.address.getFormProcessType(ec.address.processType);$(formId).find("input[name=province]").attr("value","");$(formId).find("input[name=city]").attr("value","");$(formId).find("input[name=district]").attr("value","");$(formId).find("input[name=street]").attr("value","")};ec.address.replaceChar=function(srcChar){if(srcChar!=null&&srcChar!=""&&srcChar=="-"){return"其它地区"}else{return ec.autoEncodeAttr(srcChar)}};ec.address.query=function(url,usecache,callback){var json;if(usecache&&(json=cache[url])){return callback(json)}if(ajaxer)ajaxer.abort();ajaxer=$.ajax({url:url,type:"get",dataType:"json",beforeSend:function(xhr){xhr.withCredentials=true},success:function(json){if(usecache)cache[url]=json;callback(json)},error:function(xhr,status){logger.warn("load data fail.")}})};ec.address.format=function(json){var province,city,district,street;$("input[name='province']").valS(json.values[0]);$("input[name='city']").valS(json.values[1]);$("input[name='district']").valS(json.values[2]);$("input[name='street']").valS(json.values[3]);for(var i=0;i<json.data.length;i++){for(var j=0;j<json.data[i].length;j++){if(json.data[i][j].id==json.values[0]){province=json.data[i][j].name;break}if(json.data[i][j].id==json.values[1]){city=json.data[i][j].name;break}if(json.data[i][j].id==json.values[2]){district=json.data[i][j].name;break}if(json.data[i][j].id==json.values[3]){street=json.data[i][j].name;break}}}var address=province+"&nbsp;&gt;&nbsp;"+city+"&nbsp;&gt;&nbsp;"+ec.product.replaceChar(district);if(street!=null){address=address+"&nbsp;&gt;&nbsp;"+ec.product.replaceChar(street)}$("#address").find("a").html(address)};ec.address.getFormProcessType=function(pType){var formId="#myAddress-form";switch(pType){case"1":formId="#vatinvoice-person-form";break;case"2":formId="#exchange-form";break;default:formId="#myAddress-form";break}return formId};ec.address.reset=function(){_tempAddress={};_tempAddressIds={};$("#provice").attr("data-value","");$("#city").attr("data-value","");$("#district").attr("data-value","");$("#street").attr("data-value","");$("#provice").html("请选择");$("#city").html("请选择");$("#district").html("请选择");$("#street").html("请选择");$("#address-search .form-address-search-list ul").html("")};